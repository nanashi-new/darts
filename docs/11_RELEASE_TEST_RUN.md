# 11 — Release Test Run (MAX)

## Ручные сценарии перед релизом

1. **Импорт одного XLSX (базовый happy-path)**
   - Действия: Импорт/Экспорт → «Импорт файла» → выбрать корректный XLSX с колонками ФИО/Место/Очки.
   - Ожидаемо: показывается предпросмотр, импорт завершается без ошибок, турнир и результаты появляются в списках.
   - Ошибка: падение, пустой импорт при валидном файле, некорректные очки.

2. **Импорт XLSX с пустыми строками в середине**
   - Ожидаемо: пустые строки не ломают парсинг; данные до/после обрабатываются корректно.
   - Ошибка: обрыв импорта на первой пустой строке, исключение.

3. **Импорт папки (много файлов)**
   - Действия: «Импорт папки», выбрать каталог с валидными/невалидными файлами.
   - Ожидаемо: пакет обрабатывается полностью, есть отчёт success/error по файлам.
   - Ошибка: прерывание на первом битом файле.

4. **Импорт мульти-табличного XLSX**
   - Ожидаемо: каждая таблица распознаётся блоком, есть статус/уверенность для маппинга.
   - Ошибка: берётся только первый блок или перепутаны строки между блоками.

5. **Нестандартные заголовки + Mapping Wizard**
   - Ожидаемо: можно вручную сопоставить столбцы и продолжить импорт.
   - Ошибка: мастер не позволяет завершить на корректном маппинге.

6. **Профили импорта: создание**
   - Ожидаемо: профиль сохраняется, виден в списке и повторно применим.
   - Ошибка: профиль не сохраняется после перезапуска.

7. **Профили импорта: удаление/переиспользование**
   - Ожидаемо: удалённый профиль исчезает; выбранный профиль корректно подставляет маппинг.
   - Ошибка: «фантомные» профили или неправильные поля.

8. **Дубли игроков: выбор существующего игрока и remember choice**
   - Ожидаемо: при повторе ключа ФИО+дата выбор подхватывается автоматически.
   - Ошибка: повторный диалог при включённом remember.

9. **Слияние игроков (merge players) без конфликта результатов**
   - Ожидаемо: результаты переносатся к primary, duplicate удаляется.
   - Ошибка: потеря результатов или падение.

10. **Слияние игроков с конфликтом UNIQUE(tournament_id, player_id)**
    - Ожидаемо: конфликт разрешается по стратегии (prefer_primary/prefer_duplicate), приложение не падает.
    - Ошибка: IntegrityError, «осиротевшие» записи.

11. **Пересчёт одного турнира**
    - Ожидаемо: обновляются points_place/points_classification/points_total, есть запись в журнале.
    - Ошибка: часть результатов остаётся со старой версией calc_version.

12. **Пересчёт всего рейтинга**
    - Ожидаемо: пересчитаны все турниры, статус без фатальных ошибок.
    - Ошибка: пропуски турниров, неконсистентные totals.

13. **Экспорт PDF протокола**
    - Ожидаемо: файл создаётся, не пустой, таблица не обрезана.
    - Ошибка: пустой/битый PDF, обрезанные колонки.

14. **Экспорт XLSX рейтинга**
    - Ожидаемо: корректные заголовки/строки, файл открывается Excel/openpyxl.
    - Ошибка: повреждённый файл, потеря строк.

15. **Экспорт PNG видимой области**
    - Ожидаемо: изображение соответствует viewport таблицы.
    - Ошибка: чёрный/пустой кадр.

16. **Экспорт PNG всей таблицы**
    - Ожидаемо: влезают все строки/колонки, читаемый рендер.
    - Ошибка: обрезка данных, падение в headless-среде без обработки.

17. **Batch export всех отчётов**
    - Ожидаемо: создаётся run-директория с подпапками ratings/tournaments и файлами.
    - Ошибка: неполный набор файлов, пустые файлы.

18. **Журнал аудита: фильтрация и поиск**
    - Ожидаемо: фильтр по типу события и текстовый поиск дают ожидаемые записи.
    - Ошибка: пропажа релевантных событий.

19. **Экспорт журнала в TXT**
    - Ожидаемо: TXT создаётся и содержит последовательность операций.
    - Ошибка: пустой файл при непустом журнале.

20. **Бэкап/восстановление БД на другой ПК**
    - Действия: сделать копию app.db, перенести, открыть приложением на чистом профиле.
    - Ожидаемо: игроки/турниры/результаты и журнал доступны.
    - Ошибка: несовместимость схемы, missing table/index.

21. **Проверка FAQ из меню**
    - Ожидаемо: FAQ открывается без ошибок и с корректной кодировкой.
    - Ошибка: не открывается или «кракозябры».

22. **Проверка отображения версии приложения**
    - Ожидаемо: версия видна в About/статусе (по принятому UX).
    - Ошибка: версия отсутствует или пустая.

23. **Проверка запуска на «чистом» профиле пользователя**
    - Ожидаемо: автоматически создаются рабочие файлы/директории (db/settings/norms/profiles/logs/exports по сценарию использования).
    - Ошибка: ошибки прав/пути, отсутствие критичных артефактов.

24. **Негативный импорт: битый XLSX**
    - Ожидаемо: файл помечается как error, процесс продолжает обработку остальных файлов.
    - Ошибка: фатальный останов batch.

25. **Негативный импорт: дробные значения в целочисленных полях (например 1.5)**
    - Ожидаемо: warning о некорректном целочисленном значении; приложение не падает.
    - Ошибка: crash/traceback.
