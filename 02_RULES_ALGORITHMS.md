# 02 — Правила и алгоритмы расчёта рейтинга EBCK

Связанные документы:
- Требования: [01_REQUIREMENTS.md](01_REQUIREMENTS.md)
- Модель БД: [03_DATA_MODEL_DB.md](03_DATA_MODEL_DB.md)
- Импорт Excel: [04_IMPORT_EXPORT_XLSX.md](04_IMPORT_EXPORT_XLSX.md)
- Тест-план: [09_TEST_PLAN.md](09_TEST_PLAN.md)

---

## 1. Общий принцип

После каждого соревнования игроку начисляются **рейтинговые очки EBCK**.

Очки турнира всегда считаются как:

Очки турнира = Очки за классификацию + Очки за занятое место

yaml
Копировать код

Никакие дополнительные коэффициенты не применяются.

---

## 2. Очки за классификацию (разряды)

### 2.1 Шкала разряд → очки рейтинга

| Разряд            | Очки |
|------------------|------|
| 3 юношеский      | 2    |
| 2 юношеский      | 4    |
| 1 юношеский      | 6    |
| 3 спортивный     | 8    |
| 2 спортивный     | 10   |
| 1 спортивный     | 12   |
| КМС              | 14   |

Эта шкала фиксированная.

---

### 2.2 Дисциплины

#### До 10 лет
Учитывается **только одна дисциплина**:
- «Набор очков»

#### С 10 лет и старше
Учитываются **три дисциплины**:
1. Набор очков  
2. Сектор 20  
3. Большой раунд  

---

### 2.3 Алгоритм расчёта классификации

Для **каждой дисциплины**:

1. Берётся результат игрока из протокола.
2. По таблице нормативов ЕВСК определяется **максимально выполненный разряд**.
3. Разряд переводится в очки рейтинга по шкале выше.
4. Если разряд не выполнен → **0 очков**.

После этого:

Очки классификации = сумма очков по всем дисциплинам

yaml
Копировать код

---

## 3. Очки за занятое место

### 3.1 Таблица очков за место

| Место      | Очки |
|-----------|------|
| 1         | 14   |
| 2         | 12   |
| 3–4       | 10   |
| 5–8       | 8    |
| 9–16      | 6    |
| 17–32     | 4    |
| 33–64     | 2    |
| >64 / нет | 0    |

---

### 3.2 Особые случаи
- если место не указано → 0 очков
- если место больше 64 → 0 очков
- отрицательные или некорректные значения → ошибка импорта

---

## 4. Итог турнира

Очки турнира = Очки классификации + Очки за место

yaml
Копировать код

Эти очки сохраняются в базе данных и используются для рейтинга.

---

## 5. Рейтинг (плавающий, rolling)

### 5.1 Принцип

Рейтинг игрока считается как **сумма очков последних N турниров**.

- N — настраиваемый параметр
- допустимые значения: **3…12**
- турниры сортируются по дате

Если у игрока меньше N турниров — суммируются все.

---

### 5.2 Формула

Рейтинг игрока = Σ (Очки турнира i), i ∈ последние N турниров

yaml
Копировать код

---

## 6. Категории

### 6.1 Детские и юношеские категории
- категории разделены по возрасту;
- мальчики и девочки считаются **отдельно**;
- рейтинг считается **внутри категории**.

Пример:
- Мальчики до 12
- Девочки до 12
- Юноши 15–18
- Девушки 15–18

---

### 6.2 Взрослые
- мужчины и женщины отдельно;
- возможен общий рейтинг;
Детали переходов лиг описаны в требованиях.

---

## 7. Переход по возрасту

- возраст определяется на дату турнира;
- при переходе в новую категорию:
  - история игрока сохраняется;
  - рейтинг считается заново внутри новой категории;
  - старые турниры в новой категории не участвуют.

---

## 8. Воспроизводимость

- каждый результат хранит версию алгоритма расчёта;
- при изменении правил возможен полный пересчёт;
- тесты должны подтверждать корректность.

---

Конец документа.